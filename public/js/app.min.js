// lamernews app.js - v0.0.0 - 10/23/2011
// 
// Copyright 2011 Salvatore Sanfilippo. ; Licensed Two Clause BSD
(function(a,b,$){var c="";a.login=function(){var c={username:$("input[name=username]").val(),password:$("input[name=password]").val()},d=$("input[name=register]").attr("checked");return $.ajax({type:d?"POST":"GET",url:d?"/api/create_account":"/api/login",data:c,success:function(c){var d=jQuery.parseJSON(c);d.status=="ok"?(b.cookie="auth="+d.auth+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/",a.location.href="/"):$("#errormsg").html(d.error)}}),!1},a.submit=function(){var b={news_id:$("input[name=news_id]").val(),title:$("input[name=title]").val(),url:$("input[name=url]").val(),text:$("textarea[name=text]").val(),apisecret:c};return $.ajax({type:"POST",url:"/api/submit",data:b,success:function(b){var c=jQuery.parseJSON(b);c.status=="ok"?a.location.href="/news/"+c.news_id:$("#errormsg").html(c.error)}}),!1},a.update_profile=function(){var b={email:$("input[name=email]").val(),about:$("textarea[name=about]").val(),apisecret:c};return $.ajax({type:"POST",url:"/api/updateprofile",data:b,success:function(b){var c=jQuery.parseJSON(b);c.status=="ok"?a.location.reload():$("#errormsg").html(c.error)}}),!1},a.post_comment=function(){var b={news_id:$("input[name=news_id]").val(),comment_id:$("input[name=comment_id]").val(),parent_id:$("input[name=parent_id]").val(),comment:$("textarea[name=comment]").val(),apisecret:c};return $.ajax({type:"POST",url:"/api/postcomment",data:b,success:function(b){var c=jQuery.parseJSON(b);c.status=="ok"?c.op=="insert"?a.location.href="/news/"+c.news_id+"?r="+Math.random()+"#"+c.news_id+"-"+c.comment_id:c.op=="update"?a.location.href="/editcomment/"+c.news_id+"/"+c.comment_id:c.op=="delete"&&(a.location.href="/news/"+c.news_id):$("#errormsg").html(c.error)}}),!1},$(b).ready(function(){$("news").each(function(a,b){var d=b.id,e=b.children[0].getAttribute("class");e||(b.children[0].onclick=function(){var a={news_id:d,vote_type:"up",apisecret:c};$.ajax({type:"POST",url:"/api/votenews",data:a,success:function(a){var b=jQuery.parseJSON(a),c;b.status=="ok"?(c=$("#"+d)[0],c.children[0].setAttribute("class","voted"),c.children[3].setAttribute("class","disabled")):alert("Vote not registered: "+b.error)}})});var f=b.children[3].getAttribute("class");f||(b.children[3].onclick=function(){var a={news_id:d,vote_type:"down",apisecret:c};$.ajax({type:"POST",url:"/api/votenews",data:a,success:function(a){var b=jQuery.parseJSON(a),c;b.status=="ok"?(c=$("#"+d)[0],c.children[0].setAttribute("class","disabled"),c.children[3].setAttribute("class","voted")):alert("Vote not registered: "+b.error)}})})})})})(this,this.document,this.jQuery)